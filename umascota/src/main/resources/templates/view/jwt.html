<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Demo JWT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>code{background:#f3f4f6;padding:2px 6px;border-radius:6px}</style>
    </head>
<body class="bg-gray-100 min-h-screen p-6">
    <div class="max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-xl space-y-6">
        <h1 class="text-3xl font-bold">Demo JWT (Login + Bearer)</h1>

        <section class="space-y-3">
            <h2 class="text-xl font-semibold">1) Login</h2>
            <form id="loginForm" class="grid grid-cols-1 gap-3 md:grid-cols-2">
                <input name="correoElectronico" type="email" placeholder="Correo" class="border rounded px-3 py-2" required>
                <input name="contrasena" type="password" placeholder="Contraseña" class="border rounded px-3 py-2" required>
                <button class="bg-blue-600 text-white rounded px-3 py-2 md:col-span-2" type="submit">Obtener JWT</button>
            </form>
            <div>
                <div class="text-sm text-gray-600">Token (guardado en memoria):</div>
                <textarea id="tokenBox" class="w-full border rounded px-3 py-2 h-28" readonly></textarea>
            </div>
        </section>

        <section class="space-y-3">
            <h2 class="text-xl font-semibold">2) Llamada protegida</h2>
            <button id="callBtn" class="bg-green-600 text-white rounded px-3 py-2">GET /api/protected/hello</button>
            <pre id="respBox" class="bg-gray-900 text-gray-100 p-3 rounded overflow-x-auto"></pre>
        </section>

        <section class="space-y-2 text-sm text-gray-700">
            <h3 class="font-semibold">Cómo funciona</h3>
            <ul class="list-disc pl-5">
                <li>Envías correo y contraseña a <code>POST /auth/login</code>.</li>
                <li>El backend valida y responde con <code>{ token, tipo: "Bearer" }</code>.</li>
                <li>Usa el token en el header <code>Authorization: Bearer &lt;token&gt;</code> para acceder a endpoints protegidos.</li>
            </ul>
        </section>
    </div>

<script>
let token = "";

document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const correo = e.target.correoElectronico.value;
  const contrasena = e.target.contrasena.value;

  const res = await fetch('/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ correoElectronico: correo, contrasena })
  });

  const text = await res.text();
  try {
    const data = JSON.parse(text);
    token = data.token || '';
    document.getElementById('tokenBox').value = token;
  } catch {
    document.getElementById('tokenBox').value = text;
  }
});

document.getElementById('callBtn').addEventListener('click', async () => {
  const res = await fetch('/api/protected/hello', {
    headers: { Authorization: `Bearer ${token}` }
  });
  const body = await res.text();
  document.getElementById('respBox').textContent = `${res.status} ${res.statusText}\n\n${body}`;
});
</script>
</body>
</html>


